@{
    ViewBag.Title = "Work Space";
    Layout = "~/Views/Shared/_Master.cshtml";
}

@model RuiJi.Internal.Models.ArticleItemModel
@section StartupScripts
{    
<script type="text/javascript" charset="utf-8" src="@Url.Content("~/ueditor/ueditor.config.js")"></script>
<script type="text/javascript" charset="utf-8" src="@Url.Content("~/ueditor/ueditor.all.js")"> </script>
<script type="text/javascript" src="@Url.Content("~/ueditor/lang/zh-cn/zh-cn.js")"></script>
}

@section Styles
{
<link href="@Url.Content("~/ueditor/themes/default/css/ueditor.css")" rel="stylesheet" type="text/css" />
}
    <div>
        <div id="HiddenArticleData" >
        @Html.HiddenFor(_ => _.ArticleId)
    </div>
    <ul class="verticalflow">
        <li>
            <label for="Title">Title</label><br />
            @Html.TextBoxFor(_ => _.Title)
        </li>
        <li>
            <label for="Summary">Summary</label><br />
            @Html.TextAreaFor(_ => _.Summary)
        </li>
        <li>
            <label for="ArticleCategoryId">ArticleCategory</label> <br />
            @Html.DropDownList("ArticleCategoryId", new SelectList(Model.ArticleCategoryList, "ArticleCategoryId", "Description", Model.ArticleCategoryId))
        </li>
        <li>
            <label for="Author">Author</label><br />
            @Html.TextBoxFor(_ => _.Author)
        </li>
        <li>
            <label for="IsPublished">Publish</label> <br />
            <input type="radio" id="IsPublished1" name="IsPublished" value="true" @if(Model.IsPublished){ <text> checked="checked" </text>} /> <label for="IsPublished1">Yes</label>
            <input type="radio" id="IsPublished2" name="IsPublished" value="false" @if(! Model.IsPublished){ <text> checked="checked" </text>} /> <label for="IsPublished1">No</label>
        </li>        
    </ul>
    <div>
    <script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>
    </div>
    <div id="errorMsg">

    </div>
    <div>
        <input type="button" id="btnSave" name="btnSave" value="Save" />
    </div>
    
    <script type="text/javascript">
        UE.getEditor('editor');
        @if(Model.ArticleCategoryId>0)
        {
            <text>
        var content = '@Model.ContentDetail';
        UI.getEditor('editor').setContent(content);
           </text>
        }
        var SaveUrl = '@Url.Content("~/Article/Save")';
        
        $j("#btnSubmit").click(
            function () {
                var content = UE.getEditor('editor').getContent();
                var articleId = $j("#ArticleId").val();
                var title = $j("#Title").val();
                var summary = $j("#Summary").val();
                var category = $j("#ArticleCategoryId").val();
                var author = $j("#Author").val();
                var ispublish = $j('input:radio[name="IsPublished"]:checked').val();

                $j.ajax({
                    type: "POST",
                    url: SaveUrl,
                    data: { articleId: articleId, title: title, summary: summary, contentDetail: content, articleCategoryId: category, author: author, ispublished: ispublish },
                    success: function (response) {
                        if (response.IsSuccess) {
                            alert("Add Article Success");
                        }
                        else {
                            $j("#errorMsg").empty();
                            $j("#errorMsg").html(response.ErrorMessage);
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $j("#errorMsg").empty();
                        $j("#errorMsg").html(jqXHR + "<br/>" + textStatus + "<br/>" + errorThrown);
                    }
                });
            });
    </script>    
